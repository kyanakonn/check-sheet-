<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>学習チェックリスト（項目別保存制限＆予定表表示）</title>
<style>
  body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    padding: 1em;
    background: #f8fafc;
    max-width: 480px;
    margin: auto;
  }
  h1, h2 {
    text-align: center;
    color: #334155;
  }
  label {
    display: flex;
    align-items: center;
    margin: 0.8em 0;
    font-size: 1.1em;
  }
  input[type="checkbox"] {
    width: 1.4em;
    height: 1.4em;
    margin-right: 0.5em;
  }
  input[type="checkbox"]:disabled + span {
    color: #999;
  }
  button {
    display: block;
    margin: 1em auto;
    padding: 0.8em 2em;
    font-size: 1em;
    background-color: #2563eb;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
  }
  button:disabled {
    background-color: #999;
    cursor: not-allowed;
  }
  #message {
    text-align: center;
    margin-top: 0.5em;
    color: #ef4444;
    font-weight: bold;
  }
  #today-plan {
    background: white;
    padding: 1em;
    margin-top: 1em;
    border-radius: 8px;
    box-shadow: 0 0 6px rgba(0,0,0,0.1);
  }
  #today-plan table {
    width: 100%;
    border-collapse: collapse;
  }
  #today-plan th, #today-plan td {
    border: 1px solid #ccc;
    padding: 0.4em 0.6em;
    text-align: center;
    font-size: 0.9em;
  }
</style>
</head>
<body>
<h1>学習チェックリスト</h1>

<form id="checklist-form">
  <label><input type="checkbox" id="word"><span>英単語100語</span></label>
  <label><input type="checkbox" id="long"><span>長文1本＋音読</span></label>
  <label><input type="checkbox" id="gobun"><span>古文単語＋助動詞</span></label>
  <label><input type="checkbox" id="gobun2"><span>古文読解・文法演習</span></label>
  <label><input type="checkbox" id="kanbun"><span>漢文の句法学習</span></label>
  <label><input type="checkbox" id="world"><span>世界史 教科書精読</span></label>
  <label><input type="checkbox" id="world2"><span>世界史 一問一答</span></label>
  <label><input type="checkbox" id="review"><span>夜の復習10分</span></label>
</form>

<button id="saveBtn">保存</button>
<button id="showPlanBtn">今日の予定を見る</button>
<div id="message"></div>

<div id="today-plan" style="display:none;">
  <h2>今日の予定表</h2>
  <table>
    <thead><tr><th>項目</th><th>チェック済み</th><th>保存済み</th></tr></thead>
    <tbody id="planBody"></tbody>
  </table>
  <button id="closePlanBtn">閉じる</button>
</div>

<script>
  const keys = ["word", "long", "gobun", "gobun2", "kanbun", "world", "world2", "review"];
  const saveBtn = document.getElementById("saveBtn");
  const showPlanBtn = document.getElementById("showPlanBtn");
  const messageEl = document.getElementById("message");
  const todayPlanDiv = document.getElementById("today-plan");
  const planBody = document.getElementById("planBody");
  const closePlanBtn = document.getElementById("closePlanBtn");

  function getToday() {
    const d = new Date();
    return d.toISOString().slice(0,10);
  }

  // 各項目の保存済みかどうかを取得
  function isSavedItemToday(item) {
    return localStorage.getItem(`saved-${getToday()}-${item}`) === "true";
  }

  // 各項目のチェック済み状態を取得
  function getCheckedState(item) {
    return localStorage.getItem(`checklist-${getToday()}-${item}`) === "true";
  }

  // 各項目のチェック状態をフォームに反映
  function loadTodayChecks() {
    keys.forEach(item => {
      const checked = getCheckedState(item);
      document.getElementById(item).checked = checked;
    });
  }

  // 各項目の保存済み状態に応じてチェックボックスのdisable切替
  function updateCheckboxStatus() {
    keys.forEach(item => {
      const saved = isSavedItemToday(item);
      const checkbox = document.getElementById(item);
      if(saved) {
        checkbox.disabled = true;
      } else {
        checkbox.disabled = false;
      }
    });
  }

  // メッセージクリア
  function clearMessage() {
    messageEl.textContent = "";
  }

  // 保存処理
  saveBtn.addEventListener("click", () => {
    clearMessage();
    let anySaved = false;
    const today = getToday();

    keys.forEach(item => {
      const checkbox = document.getElementById(item);
      const checked = checkbox.checked;
      if(checked && !isSavedItemToday(item)) {
        // 保存されてなければ保存
        localStorage.setItem(`checklist-${today}-${item}`, "true");
        localStorage.setItem(`saved-${today}-${item}`, "true");
        anySaved = true;
      } else if(!checked && !isSavedItemToday(item)) {
        // 未チェックなら保存しないけどlocalStorageはfalseにする
        localStorage.setItem(`checklist-${today}-${item}`, "false");
      }
    });

    if(anySaved) {
      messageEl.style.color = "green";
      messageEl.textContent = "保存しました！保存済みの項目は編集できません。";
      updateCheckboxStatus();
    } else {
      messageEl.style.color = "#ef4444";
      messageEl.textContent = "保存できる項目がありません。";
    }
  });

  // 今日の予定表を表示
  showPlanBtn.addEventListener("click", () => {
    planBody.innerHTML = "";
    keys.forEach(item => {
      const checkbox = document.getElementById(item);
      const checked = checkbox.checked ? "✅" : "❌";
      const saved = isSavedItemToday(item) ? "✔️" : "✖️";
      const labelText = checkbox.nextSibling.textContent;
      planBody.insertAdjacentHTML("beforeend",
        `<tr><td>${labelText}</td><td>${checked}</td><td>${saved}</td></tr>`);
    });
    todayPlanDiv.style.display = "block";
  });

  closePlanBtn.addEventListener("click", () => {
    todayPlanDiv.style.display = "none";
  });

  // 初期化
  window.onload = () => {
    loadTodayChecks();
    updateCheckboxStatus();
    clearMessage();
  }
</script>
</body>
</html>
